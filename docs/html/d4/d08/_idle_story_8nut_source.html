<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IdleTTD: IdleStory.nut Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IdleTTD<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">IdleTTD - a gamescript for OpenTTD</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/d08/_idle_story_8nut_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">IdleStory.nut</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d4/d08/_idle_story_8nut.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/**</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">    @file IdleStory.nut Contains class IdleStory for IdleTTD </span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">*/</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>require(<span class="stringliteral">&quot;constants.nut&quot;</span>);</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>require(<span class="stringliteral">&quot;Logger.nut&quot;</span>);</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span>require(<span class="stringliteral">&quot;IdleUtil.nut&quot;</span>);</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>require(<span class="stringliteral">&quot;IdlePages.nut&quot;</span>);</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"></span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">/**</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">    @class IdleStory</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">    @brief Class that contains main IdleTTD code.</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">    @details Once created and started in &lt;a target=&quot;_blank&quot; href=&quot;https://docs.openttd.org/gs-api/classGSController&quot;&gt;GSController&lt;/a&gt;.Start(), internally tracks all data and handles all relevant button click events.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">*/</span> </div>
<div class="foldopen" id="foldopen00014" data-start="{" data-end="};">
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html">   14</a></span><span class="keyword">class </span><a class="code hl_class" href="../../d7/d13/class_idle_story.html">IdleStory</a> {</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>    </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"></span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">        @name State variables</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">        Properties below represent the state of the current IdleTTD session</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">    */</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"></span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">        @property PlayerCompanyID</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment"></span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">        @brief   Player company ID</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">        @details Although initially set to &lt;a target=&quot;_blank&quot; href=&quot;https://docs.openttd.org/gs-api/classGSCompany&quot;&gt;GSCompany::COMPANY_INVALID&lt;/a&gt;, this value gets populated in constructor so it can be regarded as always present.</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">    */</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">   31</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> = GSCompany.COMPANY_INVALID;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <span class="comment"></span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment">        @property IdleStoryPageID</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment"></span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">        @brief   Idle story book page ID</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="comment">        @details Set to &lt;a href=&quot;https://docs.openttd.org/gs-api/classGSStoryPage&quot; target=&quot;_blank&quot;&gt;GSStoryPage&lt;/a&gt;.STORY_PAGE_INVALID by, gets created when new game starts and saved to be re-used on game load.</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="comment">        @note Although this property is public and accesible from outside it shouldn&#39;t be changed directly, [this.GetPageID()](#GetPageID)  should be used instead.</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment">    */</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">   40</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a> = GSStoryPage.STORY_PAGE_INVALID;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment"></span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment">        @property IdleBalance</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="comment"></span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment">        @brief Latest idle balance</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">        @details Amount of money that player receives (or loses) upon loading saved game. This is basically last year balance multiplied by percent value derived from @ref config_sec &quot;idle_multiplier&quot; game setting.</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment"></span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment">        Value from this property is used when changing player bank balance, and is always reset to 0 afterwards.</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">    */</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">   50</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a> = 0;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="comment"></span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">        @property _LastIdleBalance</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment"></span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">        @brief Previous idle balance</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="comment">        @details Amount of idle monay that company earned or lost upon last game load, stored in saves (and restored on load) via GSController</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="comment">    */</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    _LastIdleBalance = 0;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment"></span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">        @property _LastActiveTime</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">        @brief Last session timestamp</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="comment">        @details Unix timestamp that keeps track when the game was saved last time</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="comment">    */</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    _LastActiveTime = 0;</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment"></span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">        @property _LastYearBalance</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">        @brief Used for idle income caclulation</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="comment">        @details Balance that company had at the beggining of the year.</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">    */</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    _LastYearBalance = 0;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment"></span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment">        @property _SecondToLastYearBalance</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="comment">        @brief Used for idle income caclulation</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">        @details Balance that company had at the beggining of the previous year.</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="comment">    */</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    _SecondToLastYearBalance = 0;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment"></span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="comment">        @property _LastSessionYearlyBalance</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment">        @brief Yearly balance from last session</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">        @details Balance that was used to calculate idle balance at the start of the session</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment">    */</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    _LastSessionYearlyBalance = 0;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment"></span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">        @property _LastInactiveSeconds</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment">        @brief Used for stats screen</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">        @details Amount of seconds that passed since last save</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">    */</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    _LastInactiveSeconds = 0;</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment"></span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">        @property CurrentCash</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">        @brief Amount of cash company has</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment">        @details Amount of money the company had in the beginning of current year. Used internally for calulating idle balance</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="comment">    */</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">  100</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a> = 0;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="comment"></span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="comment">        @property PreviousMonth</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment">        @brief Latest in-game month detected</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment"></span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment">        @details Used internally to detect new year and recalculate last year balance</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">    */</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">  108</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">PreviousMonth</a> = -1;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment"></span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">        @property companyMode</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">        @brief Company mode (null if not active)</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">    </span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">        @details Reference to active company mode, used internally by #EnterCompanyMode and #LeaveCompanyMode functions.</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">    */</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">  116</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> = null;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment"></span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">        @property _SaveWarningViewed</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">        @brief Player saw warning message</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">    </span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">        @details Internally used in order to avoid reopening warning screen once closed</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment">    */</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    _SaveWarningViewed = <span class="keyword">false</span>;<span class="comment"></span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="comment">        @}</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">    */</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment"></span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">        @name Local class instances</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">        Properties below reference instances of classes created here (currently only #IdlePages).</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">    */</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment"></span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">        @property IdlePages    IdlePagesInstance</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="comment"></span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">        @brief   Reference to idle pages class instance</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">        @details Gets created in #Initialize and lives throughout the session. Manages and renders story book page screens.</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="comment">    */</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">  143</a></span>    <a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> = null;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="comment"></span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">        @}</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">    */</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="comment"></span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">        @name Cached values</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">        Properties below hold cached values for faster access</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="comment">    */</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="comment"></span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="comment">        @property array   _CachedAllVehicleStats</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="comment">        @brief Cached vehicle stats </span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">        @details Cached array of all vehicle stats, grouped by vehicle type</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="comment">    */</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    _CachedAllVehicleStats = [];</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment"></span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">        @property _CachedSummaryVehicleStats</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">        @brief Cached vehicle summary</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">        @details Cached table with summarized vehicle stats, check out #SummaryVehicleStats for details.</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="comment">    */</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    _CachedSummaryVehicleStats = {</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        count = 0,</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        balance = 0,</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        idleBalance = 0,</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    };</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment"></span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">        @}</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="comment">    */</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment"></span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="comment">        @brief Class constructor. Requires valid company id.</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">        @details Valid Company ID is required, but page ID is not. </span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">        - When new game starts constructor is called without page ID. Story book page gets created and its id is then stored with saved games to be reused.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">        - If game was loaded, #MainClass will pass existing story book page ID to the constructor.</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment"></span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">        </span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">        @param companyID    Player company ID</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">        @param storyPageID  Idle story book page ID</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00190" data-start="{" data-end="}">
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a8418ce0df004f41687045eea9f5bf7ff">  190</a></span>    constructor(companyID, storyPageID = GSStoryPage.STORY_PAGE_INVALID) {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> = companyID;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a> = storyPageID;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        this._SaveWarningViewed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> = null;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">PreviousMonth</a> = -1;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a> = 0;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a> = 0;</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        this._LastIdleBalance = 0;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        this._LastYearBalance = 0;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        this._LastInactiveSeconds = 0;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        this._LastActiveTime = 0;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        this._CachedAllVehicleStats = [];</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        this._CachedSummaryVehicleStats = {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            count = 0,</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            balance = 0,</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>            idleBalance = 0,</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        };</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> = null;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    }</div>
</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span> </div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment"></span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="comment">        @name Initialization and lifecycle</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span><span class="comment">        Functions below are setting up and starting base script functionality</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span><span class="comment">    */</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span><span class="comment"></span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="comment">        @brief Initializes game session</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="comment">        @details Called when all argument values are either loaded from saved game or set to default values (zeros) for new games. Shows idle report / missing hq / intro screen as needed.</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment"></span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">        @param lastActiveTime Saved game timestamp, stored locally as #_LastActiveTime</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">        @param lastYearBalance Saved last year balance, stored locally as #_LastYearBalance</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="comment">        @param secondToLastYearBalance Saved second to last year balance, stored locally as #_SecondToLastYearBalance</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">        @param intCurrentCash Amount of money (minus loan) that company had at the end of the last (complete) year</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment"></span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="comment">    */</span>  </div>
<div class="foldopen" id="foldopen00232" data-start="{" data-end="}">
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a4ee746cb12cc6874510439575f85a999">  232</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4ee746cb12cc6874510439575f85a999">Initialize</a>(lastActiveTime, lastYearBalance, secondToLastYearBalance, intCurrentCash) {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> = <a class="code hl_class" href="../../da/db4/class_idle_pages.html">IdlePages</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>, this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a>);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="keywordflow">if</span> (secondToLastYearBalance != 0 &amp;&amp; lastYearBalance != 0) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            <span class="comment">// set balance to 2nd last year first. It will be moved into place once last balance is set below</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">SetLastYearBalance</a>(secondToLastYearBalance);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordflow">if</span> (lastYearBalance != 0) {</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">SetLastYearBalance</a>(lastYearBalance);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        }</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        this._LastActiveTime = lastActiveTime;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a> = intCurrentCash;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <span class="keywordflow">if</span> (lastActiveTime &gt; 0) {</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>            local currentTime = GSDate.GetSystemTime();</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            local inactiveSeconds = (currentTime - lastActiveTime).tointeger();</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">SetLastInactiveSeconds</a>(inactiveSeconds);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>            this._LastSessionYearlyBalance = lastYearBalance;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">SetLastInactiveSeconds</a>(0);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            this._LastSessionYearlyBalance = 0;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        <span class="keywordflow">if</span> (!<a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a46334d3a8cc56a37c527b4af4702c304">HasHQ</a>(<span class="keyword">this</span>.PlayerCompanyID) &amp;&amp; <span class="keyword">this</span>.IdlePagesInstance != null) {</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>            <span class="keywordflow">if</span> (this._LastActiveTime == 0) { <span class="comment">// new game</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                <span class="keywordflow">if</span> (GSController.GetSetting(<span class="stringliteral">&quot;show_intro&quot;</span>)) {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowIntroScreen();</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.RenderMissingHQScreen();</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>                    <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Skipping intro due to game script settings.&quot;</span>);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            } <span class="keywordflow">else</span> { <span class="comment">// loaded game without HQ built</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowMissingHQScreen();</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            }</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        } <span class="keywordflow">else</span> { </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            local idleBalance = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a7aad523bd5f2c3634482aad2dd66bed2">CalculateIdleBalance</a>();</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4d5e40cdb668941d25303102866d38f4">ShowIdleReport</a>(idleBalance);</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        }</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a495cdecfe946a495cb8841521936cb57">Info</a>(<span class="stringliteral">&quot;IdleTTD initialized - &quot;</span> + (lastActiveTime == 0 ? <span class="stringliteral">&quot; (new game).&quot;</span> : <span class="stringliteral">&quot; (loaded game).&quot;</span>));</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    }</div>
</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="comment"></span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="comment">        @brief Executes one game script iteration</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span><span class="comment"></span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="comment">        @details This is the code that executes IdleTTD specific stuff whenever the game runs the script.</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="comment"></span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="comment">        First time in a year this gets called (preferably Jan 1st) it will store the amount of money company has. If there was a value stored for previous year, it is used to calculate balance for current year before it gets overwritten. This balance serves as a basis for idle balance calculations.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00278" data-start="{" data-end="}">
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a25e40930a26ac9f78dd42706ad8f3cf5">  278</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a25e40930a26ac9f78dd42706ad8f3cf5">runIdleLoop</a>() {</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>        local date = GSDate.GetCurrentDate();</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        <span class="keywordflow">if</span> (GSDate.IsValidDate(date)) {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>            local month = GSDate.GetMonth(date);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>            local day = GSDate.GetDayOfMonth(date);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            <span class="keywordflow">if</span> (month != this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">PreviousMonth</a>) {</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">PreviousMonth</a> == 12) {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                    local newCash = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ab28a579eebace91e5c8f9eb988aff6d8">GetCurrentCash</a>();</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                    local prevCash = this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a> = newCash;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                    local newBalance = this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">CurrentCash</a> - prevCash;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>                    <span class="keywordflow">if</span> (prevCash != 0) {</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>                        <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a990cfe64eca0a74216f8edef4b36f312">Table</a>({newCash = newCash, prevCash = prevCash, newBalance = newBalance}, <span class="stringliteral">&quot;Updated yearly balance&quot;</span>, <a class="code hl_enumeration" href="../../d0/d68/constants_8nut.html#ad28c7b0f63def160057028c0eec9128a">::ScriptLogLevels</a>.LOG_LEVEL_DEBUG);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>                        this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">SetLastYearBalance</a>(newBalance);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>                        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.StatsScreenVisible) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                            <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a3db59060a2f577bdfdc405d0df2e464b">Verbose</a>(<span class="stringliteral">&quot;Updating stats screen&quot;</span>);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                            this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                            this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                        }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                    }</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">PreviousMonth</a> = month;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            }</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        }</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    }</div>
</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="comment"></span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="comment">        @brief Handles button clicks</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span><span class="comment">        @details Called for events of type GSEvent::ET_STORYPAGE_BUTTON_CLICK whenever a button on idle story book page is clicked.</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="comment">        </span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span><span class="comment">        @note Handlers are called once per script iteration. This method can be called up to 7 in-game days (~15.5s) after the actual click itself.</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span><span class="comment">        </span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span><span class="comment">        @param buttonId Button story page element ID</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="comment">        @param event Converted event that triggered the handler</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span><span class="comment">        </span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">        </span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00319" data-start="{" data-end="}">
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a747985d06b5102dc5ed52b01846e5163">  319</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a747985d06b5102dc5ed52b01846e5163">HandleButtonClick</a>(buttonId, event) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <span class="keywordflow">if</span> (GSStoryPage.IsValidStoryPageElement(buttonId)) {</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>            <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IdleReportButtonID) {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling idle report button click.&quot;</span>);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                <span class="keywordflow">if</span> (this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4463aa3d8cfd2316b7f3a784d11cefa4">ChangeBankBalance</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a>)) {</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                    this._LastIdleBalance = this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a>;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a> = 0;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                    this._SaveWarningViewed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../df/d9f/config_8nut.html#a7f9cd212b26c4b5a6faeffbd72d2ad59">::ScriptConfig</a>.ShowStatsAfterReport) {</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                        <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a782a786488f72c3b740ae6447e95a361">CloseStoryBookWindow</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                    }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                    this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                }</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.RefreshButtonID) {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling refresh button click.&quot;</span>);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.CloseButtonID) {</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling close button click.&quot;</span>);</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a782a786488f72c3b740ae6447e95a361">CloseStoryBookWindow</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowHelpButtonID) {</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling help button click.&quot;</span>);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowHelpScreen();</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.CloseSaveWarningButtonID) {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling close save warning button click.&quot;</span>);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                this._SaveWarningViewed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.SavedWithNegativeBalance = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a782a786488f72c3b740ae6447e95a361">CloseStoryBookWindow</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IntroButtonID) {</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling intro button click.&quot;</span>);</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>                <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a782a786488f72c3b740ae6447e95a361">CloseStoryBookWindow</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ClearPage();</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>                <span class="keywordflow">if</span> (<a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a46334d3a8cc56a37c527b4af4702c304">HasHQ</a>(<span class="keyword">this</span>.PlayerCompanyID)) {</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                    this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>();</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.RenderMissingHQScreen();</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonNoHQID) {</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav noHQ button click.&quot;</span>);</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowMissingHQScreen();</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonStatsID) {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav stats button click.&quot;</span>);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#aaa8c67c06658ddf3e999d7924dec8a35">ShowStatsScreen</a>();</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonIdleReportID) {</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav idle report button click.&quot;</span>);</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4d5e40cdb668941d25303102866d38f4">ShowIdleReport</a>();</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonIntroID) {</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav intro button click.&quot;</span>);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowIntroScreen();</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonSaveWarningID) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav save warning button click.&quot;</span>);</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowSaveWarningScreen();</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buttonId == this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>._NavButtonShowHelpID) {</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Debug</a>(<span class="stringliteral">&quot;Handling (dev) nav help button click.&quot;</span>);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowHelpScreen();</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>            }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        }</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    }</div>
</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="comment"></span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="comment">        @brief Guaranteed to return valid current idle story page ID</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="comment">        @details Makes sure there is a valid idle story page and returns its ID as &lt;a href=&quot;https://docs.openttd.org/gs-api/classGSStoryPage&quot; target=&quot;_blank&quot;&gt;GSStoryPage.StoryPageID&lt;/a&gt;.</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span><span class="comment"></span> </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span><span class="comment">        \pre_resolved_company_valid{this.PlayerCompanyID}</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="comment"></span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment">        @returns GSStoryPageID Idle story page ID</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00393" data-start="{" data-end="}">
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a58fce52265f3b1a7669058a2d6d7f542">  393</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a58fce52265f3b1a7669058a2d6d7f542">GetPageID</a>() {</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID) {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>            <span class="keywordflow">if</span> (!GSStoryPage.IsValidStoryPage(<span class="keyword">this</span>.IdleStoryPageID)) {</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                local pageName = GSText(GSText.STR_REPORT_PAGE_NAME);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                local pageID = GSStoryPage.New(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                <span class="keywordflow">if</span> (GSStoryPage.IsValidStoryPage(pageID)) {</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                    this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a> = pageID;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                    <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a3db59060a2f577bdfdc405d0df2e464b">Verbose</a>(<span class="stringliteral">&quot;Created new idle story book page &quot;</span> + this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a>);</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                    <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#ab8fb54de1ae0cf356cdad2df681467ec">Error</a>(<span class="stringliteral">&quot;Failed creating idle story book page.&quot;</span>);</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                }</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a3db59060a2f577bdfdc405d0df2e464b">Verbose</a>(<span class="stringliteral">&quot;Reusing idle story book page &quot;</span> + this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a>);</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>            }</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        }</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStoryPageID</a>;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    }<span class="comment"></span></div>
</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="comment">        @} </span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment">    */</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="comment"></span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="comment">        @name Functions that manage story book pages</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">        These functions prepare data and call IdlePages instance to manage story book page screens</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="comment">    */</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><span class="comment"></span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="comment">        @brief Shows idle report screen</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="comment"></span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span><span class="comment">        @details Calculats idle balance and calls [ShowIdleReportScreen()](#IdlePages.ShowIdleReportScreen) on [this.IdlePagesInstance](#IdlePagesInstance) to show idle report screen on idle story book page.</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span><span class="comment">        @note Idle report page is \em quasi-persistent. If player closes story book without clicking the button within, script will open idle report story book page again and keep doing it until player clicks the button on the page.</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span><span class="comment"></span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span><span class="comment">        @param intNewIdleBalance New idle balance</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="comment"></span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span><span class="comment">        @retval true    Idle report story book page is displayed</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span><span class="comment">        @retval false   Failed opening idle report story book page</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00433" data-start="{" data-end="}">
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a4d5e40cdb668941d25303102866d38f4">  433</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4d5e40cdb668941d25303102866d38f4">ShowIdleReport</a>(intNewIdleBalance = 0) {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <span class="keywordflow">if</span> (intNewIdleBalance != 0) {</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>            this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a> = intNewIdleBalance;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        }</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        local vehicleSummary = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">GetSummaryVehicleStats</a>();</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        local vehicleTypeStats = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">GetAllVehicleTypeStats</a>();</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a929e5de04581c624b717751cc2d4bceb">ScrollToCompanyHQ</a>();</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowIdleReportScreen(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleBalance</a>, this._LastInactiveSeconds, vehicleSummary, vehicleTypeStats, this._LastYearBalance);</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="comment"></span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">        @brief Shows stats screen</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="comment">        @details Prepares required data and calls [ShowStatsScreen()](#IdlePages.ShowStatsScreen) on [this.IdlePagesInstance](#IdlePagesInstance) to show stats screen.</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="comment"></span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="comment">        @returns bool</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="comment">        @retval true    Story book page displayed successfully</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="comment">        @retval false   Failed displaying story book page</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00451" data-start="{" data-end="}">
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#aaa8c67c06658ddf3e999d7924dec8a35">  451</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#aaa8c67c06658ddf3e999d7924dec8a35">ShowStatsScreen</a>() {</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        local vehicleSummary = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">GetSummaryVehicleStats</a>();</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        local allVehicleStats = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">GetAllVehicleTypeStats</a>();</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowStatsScreen(vehicleSummary, allVehicleStats, this._LastIdleBalance, this._LastInactiveSeconds, this._LastYearBalance);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    }</div>
</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="comment"></span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="comment">        @brief Shows save warning screen</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">        @details When player saves the game with negative balance show a warning notifying them of idle losses</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="comment">        </span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">        @returns bool</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="comment">        @retval true    Story book page displayed successfully</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="comment">        @retval false   Failed displaying story book page</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00465" data-start="{" data-end="}">
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#af4dd48131a632e7e2d551712921dc2fd">  465</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#af4dd48131a632e7e2d551712921dc2fd">ShowSaveWarningScreen</a>() {</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        <span class="keywordflow">if</span> (!this._SaveWarningViewed &amp;&amp; this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            this._SaveWarningViewed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.ShowSaveWarningScreen();</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        }</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    }</div>
</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment"></span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="comment">        @brief Renders stats screen</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="comment">        @details Prepares required data and calls [RenderStatsScreen()](#IdlePages.RenderStatsScreen) on [this.IdlePagesInstance](#IdlePagesInstance) to render stats screen without opening story book page.</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="comment"></span> </div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00479" data-start="{" data-end="}">
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">  479</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">RenderStatsScreen</a>() {</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        local vehicleSummary = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">GetSummaryVehicleStats</a>();</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>        local allVehicleStats = this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">GetAllVehicleTypeStats</a>();</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.RenderStatsScreen(vehicleSummary, allVehicleStats, this._LastIdleBalance, this._LastInactiveSeconds, this._LastYearBalance);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    }</div>
</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="comment"></span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">        @brief Updates duration text</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="comment">        @details If [this.IdlePagesInstance.PreviousDurationElementID](#IdlePages.PreviousDurationElementID) is valid it gets updated with duration text formatted for current time - last active time</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="comment"></span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">        @retval true    Duration story page element updated</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">        @retval false   Failed updating duration story page element</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00494" data-start="{" data-end="}">
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a349428cbfc386c53a17520c8c0b7a27a">  494</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a349428cbfc386c53a17520c8c0b7a27a">UpdateDuration</a>() {</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        local currentTime = GSDate.GetSystemTime();</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        local inactiveSeconds = (currentTime - this._LastActiveTime).tointeger();</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.UpdateDuration(inactiveSeconds);</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    }</div>
</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="comment"></span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="comment">        @brief Updates warning text on idle report screen</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="comment">        @details Shows or hides text warning player about closing idle report window via button only.</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="comment"></span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment">        @param boolShowWarning Controls whether to show the warning or not</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment"></span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">        @retval true    Warning story page element updated</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">        @retval false   Failed updating warning story page element</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00510" data-start="{" data-end="}">
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a500fa9afeb6c28147de926112da25d91">  510</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a500fa9afeb6c28147de926112da25d91">UpdateReportCloseWarning</a>(boolShowWarning = <span class="keyword">true</span>) {</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.UpdateReportCloseWarning(boolShowWarning);</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    }</div>
</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment"></span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="comment">        @brief Updates save warning element on idle report screen</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">        @details Shows or hides text warning player about saving the game with negative balance</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment"></span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">        @param boolShowWarning Controls whether to show save warning or not</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment"></span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">        @retval true    Save warning story page element updated</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">        @retval false   Failed updating save warning story page element</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00524" data-start="{" data-end="}">
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a6817c405df22e242646b903930e144f1">  524</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a6817c405df22e242646b903930e144f1">UpdateReportSaveWarning</a>(boolShowWarning = <span class="keyword">true</span>) {</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.UpdateReportSaveWarning(boolShowWarning);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    }<span class="comment"></span></div>
</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">        @}</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment">    */</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment"></span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">    /** </span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">        @name Utility functions</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">        Common utility and helper functions that are too specific for util class</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">        @{</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="comment">    */</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="comment"></span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">        @brief Enters company mode</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment"></span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="comment">        @details Enters company mode and keeps local reference #companyMode to leave it later using #LeaveCompanyMode() function.</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment"></span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">        Uses `GSCompanyMode`, see &lt;a target=&quot;_blank&quot; href=&quot;https://docs.openttd.org/gs-api/classGSCompanyMode&quot;&gt;NoGO API documentation&lt;/a&gt; for reference (_link will open a new window/tab_) .</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="comment"></span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="comment">        @return boolean</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="comment">        @retval true        Entered company mode successfully</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="comment">        @retval false   Failed entering company mode</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00549" data-start="{" data-end="}">
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a6130daf1b2acf9807ceb2f5795ab0cb6">  549</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a6130daf1b2acf9807ceb2f5795ab0cb6">EnterCompanyMode</a>() {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> == null) {</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID &amp;&amp; GSCompany.ResolveCompanyID(<span class="keyword">this</span>.PlayerCompanyID) == <span class="keyword">this</span>.PlayerCompanyID) {</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> = GSCompanyMode(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        }</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    }</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> != null;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    }</div>
</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment"></span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">        @brief Leaves company mode</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="comment"></span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="comment">        @details Leaves company mode, resetting local reference #companyMode that was set in #EnterCompanyMode() function.</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="comment"></span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="comment">        @return boolean</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="comment">        @retval true        Left company mode successfully</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="comment">        @retval false   Failed leaving company mode</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00567" data-start="{" data-end="}">
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a26677bef40de4e35f4823c93aaeda000">  567</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a26677bef40de4e35f4823c93aaeda000">LeaveCompanyMode</a>() {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> != null) {</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> = null;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">companyMode</a> == null;</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    }</div>
</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="comment"></span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span><span class="comment">        @brief Stores last year balance</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span><span class="comment">        @details Updates _SecondToLastYearBalance with previous value of _LastYearBalance before setting _LastYearBalance to new value</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span><span class="comment"></span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="comment">        @param value New balance</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="comment"></span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00582" data-start="{" data-end="}">
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">  582</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">SetLastYearBalance</a>(value = 0) {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <span class="keywordflow">if</span> (this._LastYearBalance != 0) {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            this._SecondToLastYearBalance = this._LastYearBalance;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        }</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        this._LastYearBalance = value;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    }</div>
</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment"></span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="comment">        @brief Stores last inactive seconds </span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="comment">        @details Based on _LastActiveTime, this value is stored for using in strings and calculations</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="comment"></span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span><span class="comment">        @param value New value</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span><span class="comment"></span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00597" data-start="{" data-end="}">
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">  597</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">SetLastInactiveSeconds</a>(value = 0) {</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        this._LastInactiveSeconds = value;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    }</div>
</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="comment"></span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="comment">        @brief Calculates latest idle balance</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="comment">        @details Based on latest year balance, idle multiplier setting and time passed since saving the game, function calculates and returns amount that should be added or subtracted from company bank balance.</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment"></span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">        @returns integer Amount of money company earned or lost since last time game was saved.</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00607" data-start="{" data-end="}">
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a7aad523bd5f2c3634482aad2dd66bed2">  607</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a7aad523bd5f2c3634482aad2dd66bed2">CalculateIdleBalance</a>() {</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        local idleMultiplier = <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#aaa50b8e3a66ecb8774719daefe92ec41">GetIdleMultiplier</a>();</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        local currentTime = GSDate.GetSystemTime();</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        local inactiveSeconds = (currentTime - this._LastActiveTime).tointeger();</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">SetLastInactiveSeconds</a>(inactiveSeconds);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span> </div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="comment">// local passedDays = ((inactiveSeconds * 33.33) / 74).tointeger();</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        local passedDays = (floor(inactiveSeconds.tofloat() / <a class="code hl_variable" href="../../d0/d68/constants_8nut.html#ac3a984e7a00d51caa1650b5d4b083ed7">::SecondsPerGameDay</a>.tofloat())).tointeger();</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        local idleBalance = (((this._LastYearBalance / 365.0) * passedDays) * idleMultiplier).tointeger();</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        <span class="keywordflow">return</span> idleBalance;</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    }</div>
</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="comment"></span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="comment">        @brief Returns bank balance for player</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="comment"></span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="comment">        @details Can include loans</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="comment"></span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">        @param boolIgnoreLoan Ignore loan</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="comment">        @returns int Cash balance</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00627" data-start="{" data-end="}">
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#ab28a579eebace91e5c8f9eb988aff6d8">  627</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#ab28a579eebace91e5c8f9eb988aff6d8">GetCurrentCash</a> (boolIgnoreLoan = <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        local currentCash = 0;</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        local currentLoan = 0;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>        this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a6130daf1b2acf9807ceb2f5795ab0cb6">EnterCompanyMode</a>();</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        currentCash = GSCompany.GetBankBalance(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <span class="keywordflow">if</span> (!boolIgnoreLoan) {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>            currentLoan = GSCompany.GetLoanAmount();</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        }</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a26677bef40de4e35f4823c93aaeda000">LeaveCompanyMode</a>();</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordflow">return</span> currentCash - currentLoan;</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    }</div>
</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="comment"></span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="comment">        @brief Changes company bank balance</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="comment">        @details Adds (or subtracts) balanceChange amount from company bank balance. Creates news with details if balance change was successful.</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="comment"></span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span><span class="comment">        \prebase</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span><span class="comment">        @pre argument `balanceChange != 0`</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="comment"></span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><span class="comment">        @param balanceChange Amount to add or subtract from company bank balance</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="comment"></span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment">        @retval true    Balance changed successfully</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="comment">        @retval false   Balance change failed</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00654" data-start="{" data-end="}">
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a4463aa3d8cfd2316b7f3a784d11cefa4">  654</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4463aa3d8cfd2316b7f3a784d11cefa4">ChangeBankBalance</a>(balanceChange = 0) {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <span class="keywordflow">if</span> (balanceChange != 0 &amp;&amp; this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID) {</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            <span class="keywordflow">if</span> (GSCompany.ChangeBankBalance(<span class="keyword">this</span>.PlayerCompanyID, balanceChange, GSCompany.EXPENSES_OTHER, <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a6a19d5cc5857414f7f0b3bbf39c77542">GetHQTileIndex</a>(<span class="keyword">this</span>.PlayerCompanyID))) {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a495cdecfe946a495cb8841521936cb57">Info</a>(<span class="stringliteral">&quot;Bank balance changed by idle balance amount &quot;</span> + balanceChange);</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#aa557428df21d229ec98191c4e485b74b">ShowIdleBalanceNews</a>(balanceChange);</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>            }</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        }</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    }</div>
</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment"></span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">        @brief      Displays news about idle balance</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment">        @details    If script settings allow, creates and displays a news story about account balance changes caused by IdleTTD</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="comment"></span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span><span class="comment">        @param balanceChange Amount of money added or removed from company bank account</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span><span class="comment"></span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span><span class="comment">        @retval true    News created successfully</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span><span class="comment">        @retval false   Failed creating news</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00675" data-start="{" data-end="}">
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#aa557428df21d229ec98191c4e485b74b">  675</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#aa557428df21d229ec98191c4e485b74b">ShowIdleBalanceNews</a>(balanceChange) {</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        <span class="keywordflow">if</span> (GSController.GetSetting(<span class="stringliteral">&quot;show_news&quot;</span>) &amp;&amp; balanceChange != 0){</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            local newsTitle = GSText(GSText.STR_NEWS_TITLE_POSITIVE, balanceChange);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>            local newsSecondParagraph = GSText(GSText.STR_NEWS_TEXT_POSITIVE, balanceChange, <span class="keyword">this</span>.PlayerCompanyID);</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>            <span class="keywordflow">if</span> (balanceChange &lt; 0) {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                newsTitle = GSText(GSText.STR_NEWS_TITLE_NEGATIVE, balanceChange);</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                newsSecondParagraph = GSText(GSText.STR_NEWS_TEXT_NEGATIVE, balanceChange, <span class="keyword">this</span>.PlayerCompanyID);</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>            }</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>            local news = GSText(GSText.STR_NEWS_COMPLETE, newsTitle, newsSecondParagraph);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>            <span class="keywordflow">return</span> GSNews.Create(GSNews.NT_GENERAL, news, <span class="keyword">this</span>.PlayerCompanyID, GSNews.NR_NONE, -1);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        }</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <span class="keywordflow">return</span> <span class="keyword">false</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    }</div>
</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span><span class="comment"></span> </div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">        @brief Scrolls to HQ</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment">        @details Centers viewport on company hq tile if hq is built</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="comment"></span> </div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00696" data-start="{" data-end="}">
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a929e5de04581c624b717751cc2d4bceb">  696</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a929e5de04581c624b717751cc2d4bceb">ScrollToCompanyHQ</a>() {</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        local HQTile = <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a6a19d5cc5857414f7f0b3bbf39c77542">GetHQTileIndex</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        <span class="keywordflow">if</span> (GSMap.IsValidTile(HQTile)) {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>            GSViewport.ScrollTo(HQTile);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        }</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    }</div>
</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="comment"></span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span><span class="comment">        @brief Returns summary stats for all vehicles</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="comment">        @details Iterates through all vehicle types and summarizes stats (count, balance, idleBalance) for them. Values are per in-game year</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span><span class="comment"></span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="comment">        @param force Force refreshing cached stats</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span><span class="comment"></span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="comment">        @returns SQTable Summary stats table</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00711" data-start="{" data-end="}">
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">  711</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">GetSummaryVehicleStats</a>(force = <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID &amp;&amp; GSCompany.ResolveCompanyID(<span class="keyword">this</span>.PlayerCompanyID) == <span class="keyword">this</span>.PlayerCompanyID) {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            <span class="keywordflow">if</span> (force == <span class="keyword">true</span> || this._CachedAllVehicleStats.len() == 0) {</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            }</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>        <span class="keywordflow">return</span> this._CachedSummaryVehicleStats;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    }</div>
</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="comment"></span> </div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span><span class="comment">        @brief Returns vehicle stats grouped by type</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span><span class="comment">        @details Iterates through all vehicle types and summarizes stats (count, balance, idleBalance) for them (per type). Values are per in-game year.</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="comment"></span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="comment">        @param force Force refreshing cached stats</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span><span class="comment"></span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="comment">        @returns array An array of vehicle summary tables</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00729" data-start="{" data-end="}">
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">  729</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">GetAllVehicleTypeStats</a>(force = <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID &amp;&amp; GSCompany.ResolveCompanyID(<span class="keyword">this</span>.PlayerCompanyID) == <span class="keyword">this</span>.PlayerCompanyID) {</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            <span class="keywordflow">if</span> (force == <span class="keyword">true</span> || this._CachedAllVehicleStats.len() == 0) {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            }</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>        }</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>        <span class="keywordflow">return</span> this._CachedAllVehicleStats;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    }</div>
</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span><span class="comment"></span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="comment">        @brief Returns summary stats vehicles of given type</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="comment">        @details Iterates through all vehicles of the same type and summarizes stats (count, balance, idleBalance) for them. Values are per in-game year</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span><span class="comment"></span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span><span class="comment">        @param vehicleType `GSVehicle::VehicleType` Vehicle type ID</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="comment">        @param force Force refreshing cached stats</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span><span class="comment"></span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span><span class="comment">        @returns SQTable Summary stats table (or null)</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00747" data-start="{" data-end="}">
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#ab818e77714f4fa33ae381d8e9db81c2f">  747</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#ab818e77714f4fa33ae381d8e9db81c2f">GetVehicleTypeStats</a>(vehicleType, force = <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID &amp;&amp; GSCompany.ResolveCompanyID(<span class="keyword">this</span>.PlayerCompanyID) == <span class="keyword">this</span>.PlayerCompanyID) {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>            <span class="keywordflow">if</span> (force == <span class="keyword">true</span> || this._CachedAllVehicleStats.len() == 0) {</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>                this.<a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            }</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>            <span class="keywordflow">foreach</span> (index, value <span class="keywordflow">in</span> this._CachedAllVehicleStats) {</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>                <span class="keywordflow">if</span> (value.type == vehicleType) {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                    <span class="keywordflow">return</span> value;</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                }</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>            }</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        }</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        <span class="keywordflow">return</span> null;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    }</div>
</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span><span class="comment"></span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="comment">        @brief Refreshes vehicle stats cache</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">        @details Retrieves fresh values for all stats and updates cache.</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="comment"></span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span><span class="comment">        @param force Force refreshing cached stats</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="comment"></span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span><span class="comment">        @returns void</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00769" data-start="{" data-end="}">
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">  769</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">CacheVehicleStats</a>(force = <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a> != GSCompany.COMPANY_INVALID &amp;&amp; GSCompany.ResolveCompanyID(<span class="keyword">this</span>.PlayerCompanyID) == <span class="keyword">this</span>.PlayerCompanyID) {</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>            local typeCount = <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_variable" href="../../d2/de2/class_idle_util.html#a6afff2f145cc14defc320e120b82b022">AllVehicleTypes</a>.len();</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>            <span class="keywordflow">if</span> (force == <span class="keyword">true</span> || this._CachedAllVehicleStats.len() &lt; typeCount) {</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>                this._CachedAllVehicleStats = <a class="code hl_class" href="../../d2/de2/class_idle_util.html">IdleUtil</a>.<a class="code hl_function" href="../../d2/de2/class_idle_util.html#a8e284207d10f0804a354b0a2d06b159a">GetAllVehicleStatsData</a>(this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">PlayerCompanyID</a>);</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>            }</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>            this._CachedAllVehicleStats = [];</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>        }</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        local totalVehicles = 0;</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        local totalVehiclesBalance = 0;</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>        local totalVehiclesIdleBalance = 0;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        </div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordflow">foreach</span> (index, vStats <span class="keywordflow">in</span> this._CachedAllVehicleStats) {</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>            totalVehicles += vStats.count;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>            totalVehiclesBalance += vStats.balance;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>            totalVehiclesIdleBalance += vStats.idleBalance;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        }</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        this._CachedSummaryVehicleStats.count = totalVehicles;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        this._CachedSummaryVehicleStats.balance = totalVehiclesBalance;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        this._CachedSummaryVehicleStats.idleBalance = totalVehiclesIdleBalance;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        <span class="keywordflow">if</span> (totalVehicles &gt; 0) {</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            <a class="code hl_class" href="../../d3/d42/class_logger.html">Logger</a>.<a class="code hl_function" href="../../d3/d42/class_logger.html#a495cdecfe946a495cb8841521936cb57">Info</a>(<span class="stringliteral">&quot;Cached &quot;</span> + totalVehicles + <span class="stringliteral">&quot; vehicle stats&quot;</span>);</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        }</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    }</div>
</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span><span class="comment"></span> </div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span><span class="comment">        @brief Check if idle report is visible</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span><span class="comment">        @details If idle report is rendered returns true, even if story book window is closed</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span><span class="comment"></span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span><span class="comment">        @retval true Idle report is rendered</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span><span class="comment">        @retval false Idle report is not rendered</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00803" data-start="{" data-end="}">
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#aeb29563c3ce66f4f2ed0d73aea35404a">  803</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#aeb29563c3ce66f4f2ed0d73aea35404a">IsIdleReportVisible</a>() {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>            <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IdleReportVisible;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        }</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    }</div>
</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span><span class="comment"></span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="comment">        @brief Check if save warning screen is visible</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="comment">        @details If save warning is rendered returns true, even if story book window is closed</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span><span class="comment"></span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span><span class="comment">        @retval true Save warning screen is rendered</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span><span class="comment">        @retval false Save warning screen is not rendered</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00818" data-start="{" data-end="}">
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#ad9f8742608871086c9bbeb6a1bbb525d">  818</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#ad9f8742608871086c9bbeb6a1bbb525d">IsSaveWarningScreenVisible</a>() {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>            <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.SaveWarningScreenVisible;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    }</div>
</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span><span class="comment"></span> </div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="comment">        @brief Check if save warning text is added to report</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="comment">        @details If save warning text is added to report screen (and report screen is rendered) returns true</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment"></span> </div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span><span class="comment">        @retval true Warning text is added to report screen and report screen is rendered</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span><span class="comment">        @retval false Warning text is not added to report screen or report screen is not rendered</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00833" data-start="{" data-end="}">
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a624cde95da757d9c703c6b2e3755cbcb">  833</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a624cde95da757d9c703c6b2e3755cbcb">IsSaveWarningTextDisplayed</a>() {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IdleReportVisible &amp;&amp; this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.SaveWarningDisplayed;</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        }</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    }</div>
</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span><span class="comment"></span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span><span class="comment">        @brief Check if game was saved with negative balance</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span><span class="comment">        @details This function determines if game was saved while having lost money in previous year. We need to inform the player if that&#39;s the case.</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span><span class="comment"></span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="comment">        @retval true Game was saved with negative balance and no warning was displayed</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="comment">        @retval false Game was saved with positive balance __or__ it was saved with positive balance but the warning was/is already displayed to players</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00848" data-start="{" data-end="}">
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a7fb967d2ee9367e75f4492b7e8d69fbc">  848</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a7fb967d2ee9367e75f4492b7e8d69fbc">GameSavedWithNegativeBalance</a>() {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>            <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.SavedWithNegativeBalance;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        }</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    }</div>
</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span><span class="comment"></span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span><span class="comment">        @brief          Check if anything is visible</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span><span class="comment">        @details        Check if story book window is open and that any of the screens is rendered</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span><span class="comment"></span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="comment">        @return bool</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span><span class="comment">        @retval true    One of the screens is rendered and visible</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="comment">        @retval false   No screen is visible</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span><span class="comment">    */</span></div>
<div class="foldopen" id="foldopen00863" data-start="{" data-end="}">
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno"><a class="line" href="../../d7/d13/class_idle_story.html#a4a84dc1198fd1131a1c193a52c30ced2">  863</a></span>    function <a class="code hl_function" href="../../d7/d13/class_idle_story.html#a4a84dc1198fd1131a1c193a52c30ced2">IsAnyScreenOpen</a>() {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        local idlePageOpen = GSWindow.IsOpen(GSWindow.WC_STORY_BOOK, <span class="keyword">this</span>.PlayerCompanyID);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        <span class="keywordflow">if</span> (idlePageOpen) {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>            <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a> != null) {</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>                <span class="keywordflow">return</span> this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IdleReportVisible == <span class="keyword">true</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>                    || this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.IntroVisible == <span class="keyword">true</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>                    || this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.MissingHQScreenVisible == <span class="keyword">true</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>                    || this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.StatsScreenVisible == <span class="keyword">true</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>                    || this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.HelpScreenVisible == <span class="keyword">true</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>                    || this.<a class="code hl_variable" href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdlePagesInstance</a>.SaveWarningScreenVisible == <span class="keyword">true</span>;</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>            }</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        }</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>    }</div>
</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span><span class="comment"></span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span><span class="comment">        @}</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="comment">    */</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>}</div>
</div>
<div class="ttc" id="aclass_idle_pages_html"><div class="ttname"><a href="../../da/db4/class_idle_pages.html">IdlePages</a></div><div class="ttdoc">Handles story book pages for IdleTTD.</div><div class="ttdef"><b>Definition</b> IdlePages.nut:13</div></div>
<div class="ttc" id="aclass_idle_story_html"><div class="ttname"><a href="../../d7/d13/class_idle_story.html">IdleStory</a></div><div class="ttdoc">Class that contains main IdleTTD code.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:14</div></div>
<div class="ttc" id="aclass_idle_story_html_a0594404e1c9686b50d70b46b24769b74"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a0594404e1c9686b50d70b46b24769b74">IdleStory::IdleStoryPageID</a></div><div class="ttdeci">IdleStoryPageID</div><div class="ttdoc">Idle story book page ID.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:40</div></div>
<div class="ttc" id="aclass_idle_story_html_a25e40930a26ac9f78dd42706ad8f3cf5"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a25e40930a26ac9f78dd42706ad8f3cf5">IdleStory::runIdleLoop</a></div><div class="ttdeci">function runIdleLoop()</div><div class="ttdoc">Executes one game script iteration.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:278</div></div>
<div class="ttc" id="aclass_idle_story_html_a26677bef40de4e35f4823c93aaeda000"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a26677bef40de4e35f4823c93aaeda000">IdleStory::LeaveCompanyMode</a></div><div class="ttdeci">function LeaveCompanyMode()</div><div class="ttdoc">Leaves company mode.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:567</div></div>
<div class="ttc" id="aclass_idle_story_html_a343f1d94ad57bc0e6f00d9a34e6f3246"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a343f1d94ad57bc0e6f00d9a34e6f3246">IdleStory::IdleBalance</a></div><div class="ttdeci">IdleBalance</div><div class="ttdoc">Latest idle balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:50</div></div>
<div class="ttc" id="aclass_idle_story_html_a349428cbfc386c53a17520c8c0b7a27a"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a349428cbfc386c53a17520c8c0b7a27a">IdleStory::UpdateDuration</a></div><div class="ttdeci">function UpdateDuration()</div><div class="ttdoc">Updates duration text.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:494</div></div>
<div class="ttc" id="aclass_idle_story_html_a396d3466ec2cd0f415c5dab978a4b17e"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a396d3466ec2cd0f415c5dab978a4b17e">IdleStory::RenderStatsScreen</a></div><div class="ttdeci">function RenderStatsScreen()</div><div class="ttdoc">Renders stats screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:479</div></div>
<div class="ttc" id="aclass_idle_story_html_a4463aa3d8cfd2316b7f3a784d11cefa4"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a4463aa3d8cfd2316b7f3a784d11cefa4">IdleStory::ChangeBankBalance</a></div><div class="ttdeci">function ChangeBankBalance(int balanceChange=0)</div><div class="ttdoc">Changes company bank balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:654</div></div>
<div class="ttc" id="aclass_idle_story_html_a4a84dc1198fd1131a1c193a52c30ced2"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a4a84dc1198fd1131a1c193a52c30ced2">IdleStory::IsAnyScreenOpen</a></div><div class="ttdeci">function IsAnyScreenOpen()</div><div class="ttdoc">Check if anything is visible.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:863</div></div>
<div class="ttc" id="aclass_idle_story_html_a4a91a8cb3a6437f0508783a173924e72"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a4a91a8cb3a6437f0508783a173924e72">IdleStory::PreviousMonth</a></div><div class="ttdeci">PreviousMonth</div><div class="ttdoc">Latest in-game month detected.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:108</div></div>
<div class="ttc" id="aclass_idle_story_html_a4d5e40cdb668941d25303102866d38f4"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a4d5e40cdb668941d25303102866d38f4">IdleStory::ShowIdleReport</a></div><div class="ttdeci">function ShowIdleReport(int intNewIdleBalance=0)</div><div class="ttdoc">Shows idle report screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:433</div></div>
<div class="ttc" id="aclass_idle_story_html_a4ee746cb12cc6874510439575f85a999"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a4ee746cb12cc6874510439575f85a999">IdleStory::Initialize</a></div><div class="ttdeci">function Initialize(int lastActiveTime, int lastYearBalance, int secondToLastYearBalance, int intCurrentCash)</div><div class="ttdoc">Initializes game session.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:232</div></div>
<div class="ttc" id="aclass_idle_story_html_a500fa9afeb6c28147de926112da25d91"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a500fa9afeb6c28147de926112da25d91">IdleStory::UpdateReportCloseWarning</a></div><div class="ttdeci">function UpdateReportCloseWarning(bool boolShowWarning=true)</div><div class="ttdoc">Updates warning text on idle report screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:510</div></div>
<div class="ttc" id="aclass_idle_story_html_a540485a4cdf5d8309a672f02ea3b062c"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a540485a4cdf5d8309a672f02ea3b062c">IdleStory::companyMode</a></div><div class="ttdeci">companyMode</div><div class="ttdoc">Company mode (null if not active)</div><div class="ttdef"><b>Definition</b> IdleStory.nut:116</div></div>
<div class="ttc" id="aclass_idle_story_html_a58fce52265f3b1a7669058a2d6d7f542"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a58fce52265f3b1a7669058a2d6d7f542">IdleStory::GetPageID</a></div><div class="ttdeci">function GetPageID()</div><div class="ttdoc">Guaranteed to return valid current idle story page ID.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:393</div></div>
<div class="ttc" id="aclass_idle_story_html_a5ebbc3449e9db49d30910ba531f7072a"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a5ebbc3449e9db49d30910ba531f7072a">IdleStory::SetLastYearBalance</a></div><div class="ttdeci">function SetLastYearBalance(int value=0)</div><div class="ttdoc">Stores last year balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:582</div></div>
<div class="ttc" id="aclass_idle_story_html_a6130daf1b2acf9807ceb2f5795ab0cb6"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a6130daf1b2acf9807ceb2f5795ab0cb6">IdleStory::EnterCompanyMode</a></div><div class="ttdeci">function EnterCompanyMode()</div><div class="ttdoc">Enters company mode.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:549</div></div>
<div class="ttc" id="aclass_idle_story_html_a624cde95da757d9c703c6b2e3755cbcb"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a624cde95da757d9c703c6b2e3755cbcb">IdleStory::IsSaveWarningTextDisplayed</a></div><div class="ttdeci">function IsSaveWarningTextDisplayed()</div><div class="ttdoc">Check if save warning text is added to report.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:833</div></div>
<div class="ttc" id="aclass_idle_story_html_a6817c405df22e242646b903930e144f1"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a6817c405df22e242646b903930e144f1">IdleStory::UpdateReportSaveWarning</a></div><div class="ttdeci">function UpdateReportSaveWarning(bool boolShowWarning=true)</div><div class="ttdoc">Updates save warning element on idle report screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:524</div></div>
<div class="ttc" id="aclass_idle_story_html_a6aac23fcac191fb9f818da83393c7b66"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a6aac23fcac191fb9f818da83393c7b66">IdleStory::CurrentCash</a></div><div class="ttdeci">CurrentCash</div><div class="ttdoc">Amount of cash company has.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:100</div></div>
<div class="ttc" id="aclass_idle_story_html_a747985d06b5102dc5ed52b01846e5163"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a747985d06b5102dc5ed52b01846e5163">IdleStory::HandleButtonClick</a></div><div class="ttdeci">function HandleButtonClick(int buttonId, GSEventStoryPageButtonClick event)</div><div class="ttdoc">Handles button clicks.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:319</div></div>
<div class="ttc" id="aclass_idle_story_html_a7aad523bd5f2c3634482aad2dd66bed2"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a7aad523bd5f2c3634482aad2dd66bed2">IdleStory::CalculateIdleBalance</a></div><div class="ttdeci">function CalculateIdleBalance()</div><div class="ttdoc">Calculates latest idle balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:607</div></div>
<div class="ttc" id="aclass_idle_story_html_a7fb967d2ee9367e75f4492b7e8d69fbc"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a7fb967d2ee9367e75f4492b7e8d69fbc">IdleStory::GameSavedWithNegativeBalance</a></div><div class="ttdeci">function GameSavedWithNegativeBalance()</div><div class="ttdoc">Check if game was saved with negative balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:848</div></div>
<div class="ttc" id="aclass_idle_story_html_a929e5de04581c624b717751cc2d4bceb"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a929e5de04581c624b717751cc2d4bceb">IdleStory::ScrollToCompanyHQ</a></div><div class="ttdeci">function ScrollToCompanyHQ()</div><div class="ttdoc">Scrolls to HQ.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:696</div></div>
<div class="ttc" id="aclass_idle_story_html_a9b84852c6e561b881bffcf8c4b125d95"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a9b84852c6e561b881bffcf8c4b125d95">IdleStory::CacheVehicleStats</a></div><div class="ttdeci">function CacheVehicleStats(bool force=false)</div><div class="ttdoc">Refreshes vehicle stats cache.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:769</div></div>
<div class="ttc" id="aclass_idle_story_html_a9c76727439a2fee352425103d9bc1c2f"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#a9c76727439a2fee352425103d9bc1c2f">IdleStory::GetSummaryVehicleStats</a></div><div class="ttdeci">function GetSummaryVehicleStats(bool force=false)</div><div class="ttdoc">Returns summary stats for all vehicles.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:711</div></div>
<div class="ttc" id="aclass_idle_story_html_aa25635a0c58eab0462d38a65727e0688"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#aa25635a0c58eab0462d38a65727e0688">IdleStory::PlayerCompanyID</a></div><div class="ttdeci">PlayerCompanyID</div><div class="ttdoc">Player company ID.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:31</div></div>
<div class="ttc" id="aclass_idle_story_html_aa557428df21d229ec98191c4e485b74b"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#aa557428df21d229ec98191c4e485b74b">IdleStory::ShowIdleBalanceNews</a></div><div class="ttdeci">function ShowIdleBalanceNews(int balanceChange)</div><div class="ttdoc">Displays news about idle balance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:675</div></div>
<div class="ttc" id="aclass_idle_story_html_aaa8c67c06658ddf3e999d7924dec8a35"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#aaa8c67c06658ddf3e999d7924dec8a35">IdleStory::ShowStatsScreen</a></div><div class="ttdeci">function ShowStatsScreen()</div><div class="ttdoc">Shows stats screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:451</div></div>
<div class="ttc" id="aclass_idle_story_html_ab28a579eebace91e5c8f9eb988aff6d8"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#ab28a579eebace91e5c8f9eb988aff6d8">IdleStory::GetCurrentCash</a></div><div class="ttdeci">function GetCurrentCash(bool boolIgnoreLoan=false)</div><div class="ttdoc">Returns bank balance for player.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:627</div></div>
<div class="ttc" id="aclass_idle_story_html_ab818e77714f4fa33ae381d8e9db81c2f"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#ab818e77714f4fa33ae381d8e9db81c2f">IdleStory::GetVehicleTypeStats</a></div><div class="ttdeci">function GetVehicleTypeStats(int vehicleType, bool force=false)</div><div class="ttdoc">Returns summary stats vehicles of given type.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:747</div></div>
<div class="ttc" id="aclass_idle_story_html_ace351584ef5dbdaab7c63520ee340a76"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#ace351584ef5dbdaab7c63520ee340a76">IdleStory::SetLastInactiveSeconds</a></div><div class="ttdeci">function SetLastInactiveSeconds(int value=0)</div><div class="ttdoc">Stores last inactive seconds.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:597</div></div>
<div class="ttc" id="aclass_idle_story_html_ad9f8742608871086c9bbeb6a1bbb525d"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#ad9f8742608871086c9bbeb6a1bbb525d">IdleStory::IsSaveWarningScreenVisible</a></div><div class="ttdeci">function IsSaveWarningScreenVisible()</div><div class="ttdoc">Check if save warning screen is visible.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:818</div></div>
<div class="ttc" id="aclass_idle_story_html_adb1c9b398e50477034f7b5e4c89a5589"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#adb1c9b398e50477034f7b5e4c89a5589">IdleStory::IdlePagesInstance</a></div><div class="ttdeci">IdlePagesInstance</div><div class="ttdoc">Reference to idle pages class instance.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:143</div></div>
<div class="ttc" id="aclass_idle_story_html_ae6f1020275c85f032107fd7853fc1c58"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#ae6f1020275c85f032107fd7853fc1c58">IdleStory::GetAllVehicleTypeStats</a></div><div class="ttdeci">function GetAllVehicleTypeStats(bool force=false)</div><div class="ttdoc">Returns vehicle stats grouped by type.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:729</div></div>
<div class="ttc" id="aclass_idle_story_html_aeb29563c3ce66f4f2ed0d73aea35404a"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#aeb29563c3ce66f4f2ed0d73aea35404a">IdleStory::IsIdleReportVisible</a></div><div class="ttdeci">function IsIdleReportVisible()</div><div class="ttdoc">Check if idle report is visible.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:803</div></div>
<div class="ttc" id="aclass_idle_story_html_af4dd48131a632e7e2d551712921dc2fd"><div class="ttname"><a href="../../d7/d13/class_idle_story.html#af4dd48131a632e7e2d551712921dc2fd">IdleStory::ShowSaveWarningScreen</a></div><div class="ttdeci">function ShowSaveWarningScreen()</div><div class="ttdoc">Shows save warning screen.</div><div class="ttdef"><b>Definition</b> IdleStory.nut:465</div></div>
<div class="ttc" id="aclass_idle_util_html"><div class="ttname"><a href="../../d2/de2/class_idle_util.html">IdleUtil</a></div><div class="ttdoc">Class with various utility helper methods for IdleTTD with `static prop Vehicle types and functions b...</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:9</div></div>
<div class="ttc" id="aclass_idle_util_html_a46334d3a8cc56a37c527b4af4702c304"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#a46334d3a8cc56a37c527b4af4702c304">IdleUtil::HasHQ</a></div><div class="ttdeci">static function HasHQ(int companyID)</div><div class="ttdoc">Check if company HQ is built.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:274</div></div>
<div class="ttc" id="aclass_idle_util_html_a6a19d5cc5857414f7f0b3bbf39c77542"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#a6a19d5cc5857414f7f0b3bbf39c77542">IdleUtil::GetHQTileIndex</a></div><div class="ttdeci">static function GetHQTileIndex(int companyID)</div><div class="ttdoc">Get company HQ tile index.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:259</div></div>
<div class="ttc" id="aclass_idle_util_html_a6afff2f145cc14defc320e120b82b022"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#a6afff2f145cc14defc320e120b82b022">IdleUtil::AllVehicleTypes</a></div><div class="ttdeci">static AllVehicleTypes</div><div class="ttdoc">All vehicle types in OpenTTD.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:39</div></div>
<div class="ttc" id="aclass_idle_util_html_a782a786488f72c3b740ae6447e95a361"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#a782a786488f72c3b740ae6447e95a361">IdleUtil::CloseStoryBookWindow</a></div><div class="ttdeci">static function CloseStoryBookWindow(int companyID)</div><div class="ttdoc">Closes story book window.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:85</div></div>
<div class="ttc" id="aclass_idle_util_html_a8e284207d10f0804a354b0a2d06b159a"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#a8e284207d10f0804a354b0a2d06b159a">IdleUtil::GetAllVehicleStatsData</a></div><div class="ttdeci">static function GetAllVehicleStatsData(int companyID)</div><div class="ttdoc">Returns statistics for all vehicles.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:221</div></div>
<div class="ttc" id="aclass_idle_util_html_aaa50b8e3a66ecb8774719daefe92ec41"><div class="ttname"><a href="../../d2/de2/class_idle_util.html#aaa50b8e3a66ecb8774719daefe92ec41">IdleUtil::GetIdleMultiplier</a></div><div class="ttdeci">function GetIdleMultiplier()</div><div class="ttdoc">Returns idle multiplier.</div><div class="ttdef"><b>Definition</b> IdleUtil.nut:441</div></div>
<div class="ttc" id="aclass_logger_html"><div class="ttname"><a href="../../d3/d42/class_logger.html">Logger</a></div><div class="ttdoc">Class that is used for all logging in IdleTTD.</div><div class="ttdef"><b>Definition</b> Logger.nut:13</div></div>
<div class="ttc" id="aclass_logger_html_a3db59060a2f577bdfdc405d0df2e464b"><div class="ttname"><a href="../../d3/d42/class_logger.html#a3db59060a2f577bdfdc405d0df2e464b">Logger::Verbose</a></div><div class="ttdeci">static function Verbose(std::string message)</div><div class="ttdoc">Logs verbose message.</div><div class="ttdef"><b>Definition</b> Logger.nut:53</div></div>
<div class="ttc" id="aclass_logger_html_a495cdecfe946a495cb8841521936cb57"><div class="ttname"><a href="../../d3/d42/class_logger.html#a495cdecfe946a495cb8841521936cb57">Logger::Info</a></div><div class="ttdeci">static function Info(std::string message)</div><div class="ttdoc">Logs info message.</div><div class="ttdef"><b>Definition</b> Logger.nut:83</div></div>
<div class="ttc" id="aclass_logger_html_a77fd6cc7f1f8d30835a284cb74c93fd8"><div class="ttname"><a href="../../d3/d42/class_logger.html#a77fd6cc7f1f8d30835a284cb74c93fd8">Logger::Debug</a></div><div class="ttdeci">static function Debug(std::string message)</div><div class="ttdoc">Logs debug message.</div><div class="ttdef"><b>Definition</b> Logger.nut:68</div></div>
<div class="ttc" id="aclass_logger_html_a990cfe64eca0a74216f8edef4b36f312"><div class="ttname"><a href="../../d3/d42/class_logger.html#a990cfe64eca0a74216f8edef4b36f312">Logger::Table</a></div><div class="ttdeci">static function Table(SQTable tableToLog, std::string tableIdentifier, int logLevel, std::string prependText=null, bool skipIdentifer=false)</div><div class="ttdoc">Logs tables.</div><div class="ttdef"><b>Definition</b> Logger.nut:154</div></div>
<div class="ttc" id="aclass_logger_html_ab8fb54de1ae0cf356cdad2df681467ec"><div class="ttname"><a href="../../d3/d42/class_logger.html#ab8fb54de1ae0cf356cdad2df681467ec">Logger::Error</a></div><div class="ttdeci">static function Error(std::string message)</div><div class="ttdoc">Logs error message.</div><div class="ttdef"><b>Definition</b> Logger.nut:113</div></div>
<div class="ttc" id="aconfig_8nut_html_a7f9cd212b26c4b5a6faeffbd72d2ad59"><div class="ttname"><a href="../../df/d9f/config_8nut.html#a7f9cd212b26c4b5a6faeffbd72d2ad59">ScriptConfig</a></div><div class="ttdeci">GSConfig ScriptConfig</div><div class="ttdoc">Script configuration.</div><div class="ttdef"><b>Definition</b> config.nut:20</div></div>
<div class="ttc" id="aconstants_8nut_html_ac3a984e7a00d51caa1650b5d4b083ed7"><div class="ttname"><a href="../../d0/d68/constants_8nut.html#ac3a984e7a00d51caa1650b5d4b083ed7">SecondsPerGameDay</a></div><div class="ttdeci">SecondsPerGameDay</div><div class="ttdoc">Number (float) of seconds per one game day.</div><div class="ttdef"><b>Definition</b> constants.nut:51</div></div>
<div class="ttc" id="aconstants_8nut_html_ad28c7b0f63def160057028c0eec9128a"><div class="ttname"><a href="../../d0/d68/constants_8nut.html#ad28c7b0f63def160057028c0eec9128a">ScriptLogLevels</a></div><div class="ttdeci">ScriptLogLevels</div><div class="ttdoc">Log levels for IdleTTD.</div><div class="ttdef"><b>Definition</b> constants.nut:13</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../d4/d08/_idle_story_8nut.html">IdleStory.nut</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
